#!/bin/bash
#
# SPDX-License-Identifier: MIT
#

## Modular - STOCKOS
# 
# A modular file that is sourced for specific script lines required by ports running on STOCKOS.
#
# usage `[ -f "${controlfolder}/mod_${CFW_NAME}.txt" ] && source "${controlfolder}/mod_${CFW_NAME}.txt"`

if [[ "$PORT_32BIT" == "Y" ]]; then
    export SPA_PLUGIN_DIR="/usr/lib32/spa-0.2"
    export PIPEWIRE_MODULE_DIR="/usr/lib32/pipewire-0.3/"
fi

# Set TAR_OPTIONS to resolve uid/gid conflicts
export TAR_OPTIONS="--no-same-owner --no-same-permissions"

#Creating a fake DRM device
sudo mkdir -p /dev/dri
sudo mknod /dev/dri/card0 c 226 0
sudo chmod 666 /dev/dri/card0

# Set the virtual screen
CUR_TTY="/dev/null"

# Use for Godot 2
GODOT2_OPTS="-r ${DISPLAY_WIDTH}x${DISPLAY_HEIGHT} -f"

# Use for Godot 3+
GODOT_OPTS="--resolution ${DISPLAY_WIDTH}x${DISPLAY_HEIGHT} -f"

readonly raloc="/usr/lib"

if [[ "$PORT_NAME" == "Minetest" ]]; then
  export CFW_NAME="muOS"
    break
fi

pm_platform_helper() {
    if [ -e "$PM_PIPE" ]; then
        PortMasterDialogExit
    fi

    # DO SOMETHING HERE
    printf ""
}