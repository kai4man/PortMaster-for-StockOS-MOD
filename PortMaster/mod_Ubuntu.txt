#!/bin/bash
#
# SPDX-License-Identifier: MIT
#

## Modular - STOCKOS
# 
# A modular file that is sourced for specific script lines required by ports running on STOCKOS.
#
# usage `[ -f "${controlfolder}/mod_${CFW_NAME}.txt" ] && source "${controlfolder}/mod_${CFW_NAME}.txt"`

# Getting the port script name
PORT_NAME=$(basename "$0" .sh)

# Set TAR_OPTIONS to resolve uid/gid conflicts
export TAR_OPTIONS="--no-same-owner --no-same-permissions"

# Set the virtual screen
CUR_TTY="/dev/null"

# Use for Godot 2
GODOT2_OPTS="-r ${DISPLAY_WIDTH}x${DISPLAY_HEIGHT} -f"

# Use for Godot 3+
GODOT_OPTS="--resolution ${DISPLAY_WIDTH}x${DISPLAY_HEIGHT} -f"

# Use for Retroarch
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib32
readonly raloc="/usr/lib/retroarch"
readonly raconf="--config /.config/retroarch/retroarch.cfg"

# Fixing the Minetest port
if [[ "$PORT_NAME" == "Minetest" ]]; then
  export CFW_NAME="muOS"
    break
fi

pm_platform_helper() {
    if [ -e "$PM_PIPE" ]; then
        PortMasterDialogExit
    fi

    # DO SOMETHING HERE
    # Creating a fake DRM device
    sudo mkdir -p /dev/dri
    sudo mknod /dev/dri/card0 c 226 0
    sudo chmod 666 /dev/dri/card0
    printf ""
}
